from selenium import webdriver
from selenium.webdriver.common.by import By
import time

class TikTokPageInfo:
    def __new__(cls, url):
        options = webdriver.ChromeOptions()
        options.add_argument("--headless")
        options.add_argument("--disable-blink-features=AutomationControlled")
        options.add_argument("--no-sandbox")
        options.add_argument("--disable-dev-shm-usage")

        # ใช้ WebDriver Manager แทน path ตรง
        service = Service(ChromeDriverManager().install())
        driver = webdriver.Chrome(service=service, options=options)

        driver.get(url)
        time.sleep(5)
        try:
            username_text = driver.find_element(By.XPATH, '//h1[@data-e2e="user-title"]').text
            page_name_text = driver.find_element(By.XPATH, '//h2[@data-e2e="user-subtitle"]').text
            followers = driver.find_element(By.XPATH, '//strong[@data-e2e="followers-count"]').text
            likes = driver.find_element(By.XPATH, '//strong[@data-e2e="likes-count"]').text
            bio = driver.find_element(By.XPATH, '//h2[@data-e2e="user-bio"]').text
            profile_pic = driver.find_element(By.XPATH, '//img[contains(@class, "ImgAvatar")]').get_attribute("src")
        except Exception as e:
            print(f"❌ Error extracting data: {e}")
            driver.quit()
            return None

        driver.quit()
        return {
            "username": username_text,
            "page_name": page_name_text,
            "followers": followers,
            "likes": likes,
            "bio": bio,
            "profile_pic": profile_pic,
            "url": url
        }
